import{G as O,H as je,d as T,q as K,z as ke,e as g,o as p,a as t,f as j,l as C,s as N,t as _,i as Y,F as pe,h as ge,N as R,T as qe,k as Ie,c as Oe,w as Re,b as Ce,u as S}from"./app-BijJL1QD.js";import{_ as Ne}from"./AppLayout-DohwMank.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";var G,re;function ye(){if(re)return G;re=1;function r(n){var a=typeof n;return n!=null&&(a=="object"||a=="function")}return G=r,G}var D,ne;function $e(){if(ne)return D;ne=1;var r=typeof O=="object"&&O&&O.Object===Object&&O;return D=r,D}var A,oe;function _e(){if(oe)return A;oe=1;var r=$e(),n=typeof self=="object"&&self&&self.Object===Object&&self,a=r||n||Function("return this")();return A=a,A}var M,se;function Ee(){if(se)return M;se=1;var r=_e(),n=function(){return r.Date.now()};return M=n,M}var F,ie;function Le(){if(ie)return F;ie=1;var r=/\s/;function n(a){for(var i=a.length;i--&&r.test(a.charAt(i)););return i}return F=n,F}var P,ae;function Ve(){if(ae)return P;ae=1;var r=Le(),n=/^\s+/;function a(i){return i&&i.slice(0,r(i)+1).replace(n,"")}return P=a,P}var U,le;function he(){if(le)return U;le=1;var r=_e(),n=r.Symbol;return U=n,U}var B,ue;function Ge(){if(ue)return B;ue=1;var r=he(),n=Object.prototype,a=n.hasOwnProperty,i=n.toString,s=r?r.toStringTag:void 0;function d(c){var m=a.call(c,s),l=c[s];try{c[s]=void 0;var e=!0}catch{}var o=i.call(c);return e&&(m?c[s]=l:delete c[s]),o}return B=d,B}var W,de;function De(){if(de)return W;de=1;var r=Object.prototype,n=r.toString;function a(i){return n.call(i)}return W=a,W}var H,ce;function Ae(){if(ce)return H;ce=1;var r=he(),n=Ge(),a=De(),i="[object Null]",s="[object Undefined]",d=r?r.toStringTag:void 0;function c(m){return m==null?m===void 0?s:i:d&&d in Object(m)?n(m):a(m)}return H=c,H}var Q,fe;function Me(){if(fe)return Q;fe=1;function r(n){return n!=null&&typeof n=="object"}return Q=r,Q}var z,me;function Fe(){if(me)return z;me=1;var r=Ae(),n=Me(),a="[object Symbol]";function i(s){return typeof s=="symbol"||n(s)&&r(s)==a}return z=i,z}var X,be;function Pe(){if(be)return X;be=1;var r=Ve(),n=ye(),a=Fe(),i=NaN,s=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,c=/^0o[0-7]+$/i,m=parseInt;function l(e){if(typeof e=="number")return e;if(a(e))return i;if(n(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=n(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=r(e);var y=d.test(e);return y||c.test(e)?m(e.slice(2),y?2:8):s.test(e)?i:+e}return X=l,X}var J,ve;function Ue(){if(ve)return J;ve=1;var r=ye(),n=Ee(),a=Pe(),i="Expected a function",s=Math.max,d=Math.min;function c(m,l,e){var o,y,w,h,u,b,v=0,$=!1,k=!1,E=!0;if(typeof m!="function")throw new TypeError(i);l=a(l)||0,r(e)&&($=!!e.leading,k="maxWait"in e,w=k?s(a(e.maxWait)||0,l):w,E="trailing"in e?!!e.trailing:E);function L(f){var x=o,q=y;return o=y=void 0,v=f,h=m.apply(q,x),h}function xe(f){return v=f,u=setTimeout(I,l),$?L(f):h}function Se(f){var x=f-b,q=f-v,te=l-x;return k?d(te,w-q):te}function Z(f){var x=f-b,q=f-v;return b===void 0||x>=l||x<0||k&&q>=w}function I(){var f=n();if(Z(f))return ee(f);u=setTimeout(I,Se(f))}function ee(f){return u=void 0,E&&o?L(f):(o=y=void 0,h)}function Te(){u!==void 0&&clearTimeout(u),v=0,o=b=y=u=void 0}function we(){return u===void 0?h:ee(n())}function V(){var f=n(),x=Z(f);if(o=arguments,y=this,b=f,x){if(u===void 0)return xe(b);if(k)return clearTimeout(u),u=setTimeout(I,l),L(b)}return u===void 0&&(u=setTimeout(I,l)),h}return V.cancel=Te,V.flush=we,V}return J=c,J}var Be=Ue();const We=je(Be),He={class:"w-full p-2"},Qe=["placeholder"],ze={key:1,class:"block w-full truncate"},Xe={key:0,class:"absolute z-50 w-full mt-1 overflow-auto bg-white border rounded shadow-lg max-h-60"},Je={key:0,class:"p-2 text-gray-500"},Ke=["onMousedown"],Ye={key:1,class:"p-2 text-sm text-gray-500 bg-gray-50"},Ze={__name:"SearchableDropdown",props:{modelValue:[String,Number],items:{type:Array,required:!0},placeholder:{type:String,default:"Search items..."}},emits:["update:modelValue","change"],setup(r,{emit:n}){const a=r,i=n,s=T(""),d=T(!1),c=T([]),m=T(""),l=T(null),o=We(()=>{c.value=a.items.filter(u=>u.item_code.toLowerCase().includes(s.value.toLowerCase())||u.item_description.toLowerCase().includes(s.value.toLowerCase())).slice(0,100)},300);K(s,()=>{o()}),K(()=>a.modelValue,u=>{if(u){const b=a.items.find(v=>v.id===u);b&&(m.value=`${b.item_code} - ${b.item_description} (Stock: ${b.item_qty})`)}else m.value=""},{immediate:!0});const y=u=>{i("update:modelValue",u.id),i("change",u),s.value="",d.value=!1},w=()=>{d.value=!0,l.value&&setTimeout(()=>{l.value.focus()},0)},h=T(null);return ke(()=>{document.addEventListener("click",u=>{h.value&&!h.value.contains(u.target)&&(d.value=!1)})}),(u,b)=>(p(),g("div",{class:"relative",ref_key:"dropdownRef",ref:h},[t("div",{class:"relative w-full border rounded cursor-pointer select-none",onMousedown:Y(w,["prevent"])},[t("div",He,[d.value?C((p(),g("input",{key:0,ref_key:"inputRef",ref:l,"onUpdate:modelValue":b[0]||(b[0]=v=>s.value=v),type:"text",class:"w-full outline-none cursor-text",placeholder:r.placeholder},null,8,Qe)),[[N,s.value]]):(p(),g("span",ze,_(m.value||r.placeholder),1))])],32),d.value?(p(),g("div",Xe,[c.value.length===0?(p(),g("div",Je," No items found ")):j("",!0),(p(!0),g(pe,null,ge(c.value,v=>(p(),g("div",{key:v.id,onMousedown:Y($=>y(v),["prevent"]),class:"p-2 cursor-pointer hover:bg-gray-100"},_(v.item_code)+" - "+_(v.item_description)+" (Stock: "+_(v.item_qty)+") ",41,Ke))),128)),c.value.length===100?(p(),g("div",Ye," Showing first 100 results. Please refine your search if needed. ")):j("",!0)])):j("",!0)],512))}},et={class:"p-6 bg-white rounded shadow"},tt={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},rt={key:0,class:"p-4 mt-4 border rounded"},nt={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},ot=["max"],st={class:"p-2"},it={class:"p-2"},at={class:"flex justify-end"},lt=["disabled"],ut={class:"p-6 mt-4 bg-white rounded shadow"},dt={class:"flex items-center justify-between mb-4"},ct={class:"w-full border-collapse"},ft={class:"p-2 border"},mt={class:"p-2 border"},bt={class:"p-2 border"},vt={class:"p-2 border"},pt={class:"p-2 border"},gt={class:"p-2 border"},yt=["onClick"],_t={class:"flex justify-end mt-4"},Tt={__name:"Index",props:{sales:Object,inventory:Array,filters:Object},setup(r){const n=r,a=T(n.filters.search||"");K(a,l=>{R.get(route("sales.index"),{search:l},{preserveState:!0,replace:!0})},{deep:!0});const i=T(null),s=qe({item_id:"",item_qty:1,customer:""}),d=Ie(()=>{if(!i.value)return null;const l=n.inventory.find(e=>e.id===i.value);return l?{...l,total:(l.item_price*s.item_qty).toFixed(2)}:null}),c=()=>{s.post(route("sales.store"),{onSuccess:()=>{s.reset(),i.value=null}})},m=l=>{confirm("Are you sure you want to cancel this sale?")&&R.delete(route("sales.destroy",l))};return(l,e)=>(p(),Oe(Ne,{title:"Sales"},{default:Re(()=>[t("div",et,[e[12]||(e[12]=t("h2",{class:"mb-4 text-xl font-bold"},"Create New Sale",-1)),t("form",{onSubmit:Y(c,["prevent"]),class:"space-y-4"},[t("div",tt,[t("div",null,[e[7]||(e[7]=t("label",{class:"block mb-2 text-sm font-medium"},"Select Item",-1)),Ce(Ze,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value=o),items:r.inventory,placeholder:"Search for an item...",onChange:e[1]||(e[1]=o=>S(s).item_id=o.id)},null,8,["modelValue","items"])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block mb-2 text-sm font-medium"},"Customer Name",-1)),C(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>S(s).customer=o),class:"w-full p-2 border rounded",placeholder:"Enter customer name"},null,512),[[N,S(s).customer]])])]),d.value?(p(),g("div",rt,[t("div",nt,[t("div",null,[e[9]||(e[9]=t("label",{class:"block mb-2 text-sm font-medium"},"Quantity",-1)),C(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=o=>S(s).item_qty=o),max:d.value.item_qty,min:"1",class:"w-full p-2 border rounded"},null,8,ot),[[N,S(s).item_qty]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block mb-2 text-sm font-medium"},"Unit Price",-1)),t("p",st,"₱"+_(d.value.item_price),1)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block mb-2 text-sm font-medium"},"Total Amount",-1)),t("p",it,"₱"+_(d.value.total),1)])])])):j("",!0),t("div",at,[t("button",{type:"submit",class:"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-700",disabled:!i.value||S(s).processing}," Complete Sale ",8,lt)])],32)]),t("div",ut,[t("div",dt,[e[13]||(e[13]=t("h2",{class:"text-xl font-bold"},"Sales History",-1)),C(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=o=>a.value=o),placeholder:"Search sales...",class:"p-2 border rounded"},null,512),[[N,a.value]])]),t("table",ct,[e[14]||(e[14]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"p-2 text-left border"},"Item"),t("th",{class:"p-2 text-left border"},"Customer"),t("th",{class:"p-2 text-left border"},"Quantity"),t("th",{class:"p-2 text-left border"},"Amount"),t("th",{class:"p-2 text-left border"},"Date"),t("th",{class:"p-2 text-left border"},"Actions")])],-1)),t("tbody",null,[(p(!0),g(pe,null,ge(r.sales.data,o=>(p(),g("tr",{key:o.id},[t("td",ft,_(o.created_by.item_code),1),t("td",mt,_(o.customer),1),t("td",bt,_(o.item_qty),1),t("td",vt,"₱"+_(o.amount_sold),1),t("td",pt,_(new Date(o.created_at).toLocaleDateString()),1),t("td",gt,[t("button",{onClick:y=>m(o.id),class:"text-red-500 hover:text-red-700"}," Cancel ",8,yt)])]))),128))])]),t("div",_t,[r.sales.prev_page_url?(p(),g("button",{key:0,onClick:e[5]||(e[5]=o=>S(R).get(r.sales.prev_page_url)),class:"px-4 py-2 mr-2 text-white bg-blue-500 rounded hover:bg-blue-700"}," Previous ")):j("",!0),r.sales.next_page_url?(p(),g("button",{key:1,onClick:e[6]||(e[6]=o=>S(R).get(r.sales.next_page_url)),class:"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-700"}," Next ")):j("",!0)])])]),_:1}))}};export{Tt as default};
